# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–ü–∞–ø–∫–∞ `vm/configs/` —Å–æ–¥–µ—Ä–∂–∏—Ç **–≥–æ—Ç–æ–≤—ã–µ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é** –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è —á–µ—Ä–µ–∑ **—Å–∏–º–ª–∏–Ω–∫–∏**.

## –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

- **[–ì–ª–∞–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](../../README.md)** ‚Äî –æ—Å–Ω–æ–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
- **[VM Directory](../README.md)** ‚Äî –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–∞–ø–∫–∏ vm/
- **[DNS –¥–æ–º–µ–Ω—ã](lxc/dnsmasq.d/README.md)** ‚Äî –ø–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ dnsmasq –∏ –∫–∞—Å—Ç–æ–º–Ω—ã–º –¥–æ–º–µ–Ω–∞–º

---

### LXC –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

#### –ë–∞–∑–æ–≤–∞—è —Å–µ—Ç—å

**`vm/configs/lxc/lxc-net`** ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ç–∏ LXC (–≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é):

```bash
USE_LXC_BRIDGE="true"
LXC_BRIDGE="lxcbr0"
LXC_ADDR="10.0.3.1"
LXC_NETWORK="10.0.3.0/24"
LXC_DHCP_RANGE="10.0.3.2,10.0.3.254"
LXC_DOMAIN="lxc"
LXC_DHCP_CONFILE="/etc/lxc/dnsmasq.d"  # –£–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ!
```

–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –ø–æ–ª—É—á–∞—é—Ç IP –∏–∑ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ `10.0.3.2-254` –∏ –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ –∏–º–µ–Ω–∞–º `*.lxc`.

#### –î–µ—Ñ–æ–ª—Ç–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

**`vm/configs/lxc/default.conf`** ‚Äî —Å–µ—Ç–µ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–æ–≤—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ (–≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é):

```bash
lxc.net.0.type = veth
lxc.net.0.link = lxcbr0
lxc.net.0.flags = up
lxc.net.0.hwaddr = 00:16:3e:xx:xx:xx
```

–≠—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫–æ –≤—Å–µ–º –Ω–æ–≤—ã–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

#### –ö–∞—Å—Ç–æ–º–Ω—ã–µ DNS –¥–æ–º–µ–Ω—ã

**`vm/configs/lxc/dnsmasq.d/custom-domains.conf`** ‚Äî –¥–æ–±–∞–≤—å —Å–≤–æ–∏ –¥–æ–º–µ–Ω—ã:

–§–∞–π–ª —É–∂–µ —Å–æ–∑–¥–∞–Ω —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏. –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π –Ω—É–∂–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ –∏–ª–∏ –¥–æ–±–∞–≤—å —Å–≤–æ–∏:

```bash
# –ü—Ä–∏–º–µ—Ä: —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –∞–¥—Ä–µ—Å–∞ –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
address=/web.myproject.local/10.0.3.100
address=/api.myproject.local/10.0.3.101
address=/db.myproject.local/10.0.3.102

# –ê–ª–∏–∞—Å—ã
cname=www.myproject.local,web.myproject.local

# Wildcard –¥–æ–º–µ–Ω (–≤—Å–µ *.app -> 10.0.3.200)
address=/.app/10.0.3.200
```

**–ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è:**

```bash
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π —Ñ–∞–π–ª –≤ Windows
notepad vm\configs\lxc\dnsmasq.d\custom-domains.conf

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ LXC —Å–µ—Ç—å
vagrant ssh -c "sudo systemctl restart lxc-net"
```

** –ü–æ–¥—Ä–æ–±–Ω–µ–µ:** [vm/configs/lxc/dnsmasq.d/README.md](./vm/configs/lxc/dnsmasq.d/README.md)

### SSH –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**`vm/configs/ssh/sshd_config`** ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ SSH —Å–µ—Ä–≤–µ—Ä–∞ (–≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é):

–í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É–∂–µ –≤–∫–ª—é—á–µ–Ω—ã:

```bash
# SOCKS5 –ø—Ä–æ–∫—Å–∏ –∏ —Ç—É–Ω–Ω–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ
AllowTcpForwarding yes
PermitTunnel yes

# –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
PubkeyAuthentication yes
PasswordAuthentication yes

# X11 forwarding
X11Forwarding yes

# Keep-alive –¥–ª—è –¥–æ–ª–≥–∏—Ö —Å–µ—Å—Å–∏–π
ClientAliveInterval 60
ClientAliveCountMax 3
```

–ö–æ–Ω—Ñ–∏–≥ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ. –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å:

```bash
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π –≤ Windows
notepad vm\configs\ssh\sshd_config

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ SSH
vagrant ssh -c "sudo systemctl restart ssh"
```

### systemd-resolved –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**`vm/configs/systemd/resolved.conf`** ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ DNS —Ä–µ–∑–æ–ª–≤–∏–Ω–≥–∞ (–≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é):

```bash
DNS=10.0.3.1                    # LXC dnsmasq
FallbackDNS=8.8.8.8 8.8.4.4     # Google DNS –∫–∞–∫ –∑–∞–ø–∞—Å–Ω–æ–π
```

## üîÑ –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π

```bash
# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤—Å–µ –∫–æ–Ω—Ñ–∏–≥–∏ –∑–∞–Ω–æ–≤–æ
vagrant ssh -c "bash /vagrant/vm/scripts/apply-configs.sh"
```

### –ö–∞–∫ —É–∑–Ω–∞—Ç—å IP –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

```bash
sudo lxc-info -n container_name -iH
sudo lxc-ls -f
```
